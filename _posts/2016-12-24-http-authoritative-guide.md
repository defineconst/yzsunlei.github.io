# Http权威指南（笔记）
* Author: Ray Sun
* Date: 2016/12/24

# URL与资源
* URL就是因特网资源的标准化名称
* URL = 协议(scheme) + 服务器位置(domain or ip) + 资源路径(path)
* 自动扩展url：主机名扩展、历史记录扩展
* URL并不完美：可以通过资源地址找到资源，一旦资源被移走，URL就不再有效了。永久统一资源定位符是用URL来实现对资源的url进行登记和跟踪

# HTTP报文
* http报文是在http应用程序之间发送的数据块
* 所有报文都向下游流动，不管是请求报文还是响应报文
* http报文的三个部分：起始行、首部、主体
* 报文的简要描述：方法(method)、请求URL(request-url)、版本(version)、状态码(status-code)、原因短语(reason-phrase)、首部(header)、主体部分(entity-body)
* 报文都以一个起始行作为开始：请求报文的起始行说明了要做些什么，响应报文的起始行说明发生了什么
* 常用的HTTP方法：GET、HEAD、POST、PUT、TRACE、OPTIONS、DELETE（HTTP1.0定义了三种请求方法：GET、POST、HEAD，HTTP1.1新增五种请求方法：OPTIONS、PUT、DELETE、TRACE、CONNECT）
* 状态码分类：信息提示(100-101)、成功(200-306)、重定向(300-305)、客户端错误(400-415)、服务器错误(500-505)，括号内表示已经定义了的，也可以对当前协议的扩展进行定义
* 并不是每一个服务器都实现以上七种方法，如果一台服务器要与HTTP1.1兼容，那么只要为其资源实现GET方法和HEAD方法就可以了
* GET方法和HEAD方法的HTTP请求都不会产生什么动作
* DELETE方法所做的事情是请服务器删除请求URL所指定的资源。客户端应用程序无法保证删除操作一定会被执行
* WebDAV HTTP扩展：LOCK(允许用户锁定资源)，MKCOL(允许用户创建资源)，COPY(便于服务器上复制资源)，MOVE(在服务器上移动资源)

# 连接管理
* HTTP连接是HTTP报文传输的关键通道
* TCP流是分段的、由IP分组传送
* 安全版本HTTPS就是HTTP和TCP之间插入一个(称为TLS或SSL的)密码加密层
* 每一个TCP段都是由IP分组承载，从一个IP地址发送到另一个IP地址的。每个分组中包括：一个IP分组首部、一个TCP段首部、一个TCP数据块
* IP首部包含缘何目的IP地址、长度和其他一些标记。TCP段首部包含了TCP端口号、TCP控制标记、以及用于数据排序和完整性检查的一些数字值
* TCP连接是通过4个只来识别的：源IP地址、源端口号、目的IP地址、目的端口号
* 串行HTTP事务的时间线：DNS查询、连接、请求、处理、响应、关闭
* 最常见的TCP相关时延：TCP连接建立握手、TCP慢启动拥塞控制、数据聚集的Nagle算法、用于捎带确认的TCP延迟确认算法、TIME_WAIT时延和端口耗尽
* 基本web服务器请求的步骤：建立连接、接收请求、处理请求、访问资源、构建响应、发送响应、记录事务处理过程

# 代理
* Web代理、中间实体、客户端和服务器之间、来回传送HTTP报文
* 使用代理用途：信息过滤、文档访问控制、安全防火墙、web缓存、反向代理、
* 防止用户绕过控制代理：静态的配置web服务器，使其仅接受来自代理服务器的请求
* 代理获取流量方法：修改客户端、修改网络(拦截)、修改DNS的命名空间、修改web服务器
* 客户端代理设置：手工配置、预先配置浏览器、代理的自动配置、WPAD的代理发现
* HTTP/1.0要求代理请求发送完整的URI，但为服务器请求保留部分URI的形式
* 虚拟主机的问题(多个web站点共享一个物理web服务器)，显式的代理要求在请求报文中使用完整的URI来解决问题，虚拟主机web服务器要求使用Host来承载主机和端口信息
* 反向代理和拦截代理都是客户端无法区分出来的，客户端只会发送部分的URI
* 没有代理的情况下，浏览器会进行主机名自动扩展(比如输入yahoo，大多数浏览器都会自动将其扩展为www.yahoo.com)
* 有显式代理时，浏览器不会对不完整主机名进行自动扩展
* 使用拦截代理时，浏览器无法检测出已经停用服务器的IP地址
* 用OPTIONS来判定服务器支持的方法，如请求整个服务器所支持的功能：`OPTIONS * HTTP/1.1`

# 缓存
* 缓存可以处理的问题：冗余的数据传输、带宽瓶颈、瞬间拥塞、距离时延
* 收到GET If-Modified-Since请求时发生的情况：再验证命中（服务器内容未被修改）、再验证未命中（服务器内容已被修改）、对象被删除（服务器上的对象被删除了）
* 命中率衡量：缓存命中率（或文档命中率，由缓存提供服务的请求所占的比例），字节命中率（缓存中提供的字节在传输的所有字节中所占的比例）
* 区分命中和未命中：使用Date首部，将响应中的Date首部的值与当前时间进行比较
* 缓存的处理步骤：接收、解析、查询、新鲜度检测、创建响应、发送、日志
* 注意：缓存不应该调整Date首部，Date首部表示的是原始服务器最初产生这个对象的日期
* 服务器使用HTTP/1.0+的Expires首部或HTTP/1.1的Cache-Control:max-age的响应首部来指定过期日期，同时还会带有响应主体
* 设置缓存控制：控制Apache的HTTP首部、通过HTTP-EQUIV控制HTML缓存（有些软件会忽略这种HTTP-EQUIV标签）
* 对于发布广告者，理想情况下，内容提供商会让缓存吸收其流量，而缓存会告诉内容提供商他们拦截了多少次命中

# 集成点：网关、隧道及中继

























